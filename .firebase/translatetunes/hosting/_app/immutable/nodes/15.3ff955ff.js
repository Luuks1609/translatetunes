import{s as Y,v as x,r as $,g as T,c as D,h as C,i as j,d as O,Z as P,k as A,D as G,E as ee,F as te,l as v,m as y,A as ne}from"../chunks/scheduler.635b56cd.js";import{S as ie,i as se,d as B,v as ae,j as oe,k as le,m as ce,b as ue,t as fe,l as re,e as b,g as k,a as V,n as p,q as N,s as M}from"../chunks/index.1e81eea3.js";import{g as me}from"../chunks/globals.7f7f1b26.js";import{A as Q}from"../chunks/AuthCheck.937e7621.js";import{e as E,a as q,d as U,f as H,n as J}from"../chunks/firebase.a6fa023d.js";const{console:de}=me,S="src/routes/(unprotected)/register/username/+page.svelte";function z(n){let e,t,c,i;const a={c:function(){e=T("p"),t=v("Checking availability of @"),c=v(n[0]),i=v("..."),this.h()},l:function(l){e=C(l,"P",{class:!0});var m=j(e);t=y(m,"Checking availability of @"),c=y(m,n[0]),i=y(m,"..."),m.forEach(b),this.h()},h:function(){k(e,"class","text-secondary"),A(e,S,66,4,1705)},m:function(l,m){V(l,e,m),p(e,t),p(e,c),p(e,i)},p:function(l,m){m&1&&M(c,l[0])},d:function(l){l&&b(e)}};return B("SvelteRegisterBlock",{block:a,id:z.name,type:"if",source:"(66:3) {#if loading}",ctx:n}),a}function F(n){let e,t="must be 3-16 characters long, alphanumeric only";const c={c:function(){e=T("p"),e.textContent=t,this.h()},l:function(a){e=C(a,"P",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1cznyih"&&(e.textContent=t),this.h()},h:function(){k(e,"class","text-error text-sm"),A(e,S,70,4,1820)},m:function(a,o){V(a,e,o)},d:function(a){a&&b(e)}};return B("SvelteRegisterBlock",{block:c,id:F.name,type:"if",source:"(70:3) {#if !isValid && isTouched}",ctx:n}),c}function I(n){let e,t,c,i;const a={c:function(){e=T("p"),t=v("@"),c=v(n[0]),i=v(" is not available"),this.h()},l:function(l){e=C(l,"P",{class:!0});var m=j(e);t=y(m,"@"),c=y(m,n[0]),i=y(m," is not available"),m.forEach(b),this.h()},h:function(){k(e,"class","text-warning text-sm"),A(e,S,74,4,1961)},m:function(l,m){V(l,e,m),p(e,t),p(e,c),p(e,i)},p:function(l,m){m&1&&M(c,l[0])},d:function(l){l&&b(e)}};return B("SvelteRegisterBlock",{block:a,id:I.name,type:"if",source:"(74:3) {#if isValid && !isAvailable && !loading}",ctx:n}),a}function Z(n){let e,t,c;const i={c:function(){e=T("button"),t=v("Confirm username @"),c=v(n[0]),this.h()},l:function(o){e=C(o,"BUTTON",{class:!0});var l=j(e);t=y(l,"Confirm username @"),c=y(l,n[0]),l.forEach(b),this.h()},h:function(){k(e,"class","btn btn-success"),A(e,S,80,4,2072)},m:function(o,l){V(o,e,l),p(e,t),p(e,c)},p:function(o,l){l&1&&M(c,o[0])},d:function(o){o&&b(e)}};return B("SvelteRegisterBlock",{block:i,id:Z.name,type:"if",source:"(80:3) {#if isAvailable}",ctx:n}),i}function W(n){let e,t,c,i,a,o,l,m,d,f=n[1]&&z(n),r=!n[3]&&n[5]&&F(n),h=n[3]&&!n[2]&&!n[1]&&I(n),_=n[2]&&Z(n);const R={c:function(){e=T("form"),t=T("input"),c=D(),i=T("div"),f&&f.c(),a=D(),r&&r.c(),o=D(),h&&h.c(),l=D(),_&&_.c(),this.h()},l:function(u){e=C(u,"FORM",{class:!0});var s=j(e);t=C(s,"INPUT",{type:!0,placeholder:!0,class:!0}),c=O(s),i=C(s,"DIV",{class:!0});var g=j(i);f&&f.l(g),a=O(g),r&&r.l(g),o=O(g),h&&h.l(g),l=O(g),_&&_.l(g),g.forEach(b),s.forEach(b),this.h()},h:function(){k(t,"type","text"),k(t,"placeholder","Username"),k(t,"class","input w-full text-black"),P(t,"input-error",!n[3]&&n[5]),P(t,"input-warning",n[4]),P(t,"input-success",n[2]&&n[3]&&!n[1]),A(t,S,54,2,1364),k(i,"class","my-4 min-h-16 w-full"),A(i,S,64,2,1649),k(e,"class",""),A(e,S,53,1,1303)},m:function(u,s){V(u,e,s),p(e,t),G(t,n[0]),p(e,c),p(e,i),f&&f.m(i,null),p(i,a),r&&r.m(i,null),p(i,o),h&&h.m(i,null),p(i,l),_&&_.m(i,null),m||(d=[N(t,"input",n[8]),N(t,"input",n[6],!1,!1,!1,!1),N(e,"submit",ee(n[7]),!1,!0,!1,!1)],m=!0)},p:function(u,s){s&1&&t.value!==u[0]&&G(t,u[0]),s&40&&P(t,"input-error",!u[3]&&u[5]),s&16&&P(t,"input-warning",u[4]),s&14&&P(t,"input-success",u[2]&&u[3]&&!u[1]),u[1]?f?f.p(u,s):(f=z(u),f.c(),f.m(i,a)):f&&(f.d(1),f=null),!u[3]&&u[5]?r||(r=F(u),r.c(),r.m(i,o)):r&&(r.d(1),r=null),u[3]&&!u[2]&&!u[1]?h?h.p(u,s):(h=I(u),h.c(),h.m(i,l)):h&&(h.d(1),h=null),u[2]?_?_.p(u,s):(_=Z(u),_.c(),_.m(i,null)):_&&(_.d(1),_=null)},d:function(u){u&&b(e),f&&f.d(),r&&r.d(),h&&h.d(),_&&_.d(),m=!1,te(d)}};return B("SvelteRegisterBlock",{block:R,id:W.name,type:"slot",source:"(53:0) <AuthCheck>",ctx:n}),R}function L(n){let e,t;e=new Q({props:{$$slots:{default:[W]},$$scope:{ctx:n}},$$inline:!0});const c={c:function(){oe(e.$$.fragment)},l:function(a){le(e.$$.fragment,a)},m:function(a,o){ce(e,a,o),t=!0},p:function(a,[o]){const l={};o&2111&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(ue(e.$$.fragment,a),t=!0)},o:function(a){fe(e.$$.fragment,a),t=!1},d:function(a){re(e,a)}};return B("SvelteRegisterBlock",{block:c,id:L.name,type:"component",source:"",ctx:n}),c}const K=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function he(n,e,t){let c,i,a,o;x(q,"user"),$(n,q,s=>t(10,o=s));let{$$slots:l={},$$scope:m}=e;ae("Page",l,[]);let d="",f=!1,r=!1,h;async function _(){t(2,r=!1),clearTimeout(h),t(1,f=!0),t(0,d=d.toLowerCase()),h=setTimeout(async()=>{console.log("checking availability of",d);const s=U(E,"usernames",d),g=await H(s).then(X=>X.exists());t(2,r=!g),t(1,f=!1)},500)}async function R(){console.log("confirming username",d);const s=J(E);s.set(U(E,"usernames",d),{uid:o==null?void 0:o.uid}),s.set(U(E,"users",o.uid),{username:d,score:0}),await s.commit(),t(0,d=""),t(2,r=!1),window.location.href="/"}const w=[];Object.keys(e).forEach(s=>{!~w.indexOf(s)&&s.slice(0,2)!=="$$"&&s!=="slot"&&de.warn(`<Page> was created with unknown prop '${s}'`)});function u(){d=this.value,t(0,d)}return n.$capture_state=()=>({AuthCheck:Q,db:E,user:q,doc:U,getDoc:H,writeBatch:J,username:d,loading:f,isAvailable:r,debounceTimer:h,re:K,checkAvailability:_,confirmUsername:R,isValid:c,isTaken:a,isTouched:i,$user:o}),n.$inject_state=s=>{"username"in s&&t(0,d=s.username),"loading"in s&&t(1,f=s.loading),"isAvailable"in s&&t(2,r=s.isAvailable),"debounceTimer"in s&&(h=s.debounceTimer),"isValid"in s&&t(3,c=s.isValid),"isTaken"in s&&t(4,a=s.isTaken),"isTouched"in s&&t(5,i=s.isTouched)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&1&&t(3,c=(d==null?void 0:d.length)>2&&d.length<16&&K.test(d)),n.$$.dirty&1&&t(5,i=d.length>0),n.$$.dirty&14&&t(4,a=c&&!r&&!f)},[d,f,r,c,a,i,_,R,u]}class ve extends ie{constructor(e){super(e),se(this,e,he,L,Y,{}),B("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:L.name})}}export{ve as component};
